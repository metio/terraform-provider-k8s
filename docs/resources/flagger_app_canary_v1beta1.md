---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "k8s_flagger_app_canary_v1beta1 Resource - terraform-provider-k8s"
subcategory: "flagger.app/v1beta1"
description: |-
  Canary is the Schema for the Canary API.
---

# k8s_flagger_app_canary_v1beta1 (Resource)

Canary is the Schema for the Canary API.

## Example Usage

```terraform
resource "k8s_flagger_app_canary_v1beta1" "minimal" {
  metadata = {
    name = "test"
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `metadata` (Attributes) Data that helps uniquely identify this object. See https://github.com/kubernetes/community/blob/master/contributors/devel/sig-architecture/api-conventions.md#metadata for more details. (see [below for nested schema](#nestedatt--metadata))

### Optional

- `spec` (Attributes) CanarySpec defines the desired state of a Canary. (see [below for nested schema](#nestedatt--spec))

### Read-Only

- `api_version` (String) APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
- `id` (Number) The timestamp of the last change to this resource.
- `kind` (String) Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
- `yaml` (String) The generated manifest in YAML format.

<a id="nestedatt--metadata"></a>
### Nested Schema for `metadata`

Required:

- `name` (String) Unique identifier for this object. See https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names for more details.

Optional:

- `annotations` (Map of String) Keys and values that can be used by external tooling to store and retrieve arbitrary metadata about this object. See https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/ for more details.
- `labels` (Map of String) Keys and values that can be used to organize and categorize objects. See https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/ for more details.
- `namespace` (String) Namespaces provides a mechanism for isolating groups of resources within a single cluster. See https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/ for more details.


<a id="nestedatt--spec"></a>
### Nested Schema for `spec`

Required:

- `analysis` (Attributes) Canary analysis for this canary (see [below for nested schema](#nestedatt--spec--analysis))
- `service` (Attributes) Kubernetes Service spec (see [below for nested schema](#nestedatt--spec--service))
- `target_ref` (Attributes) Target selector (see [below for nested schema](#nestedatt--spec--target_ref))

Optional:

- `autoscaler_ref` (Attributes) Scaler selector (see [below for nested schema](#nestedatt--spec--autoscaler_ref))
- `ingress_ref` (Attributes) Ingress selector (see [below for nested schema](#nestedatt--spec--ingress_ref))
- `metrics_server` (String) Prometheus URL
- `progress_deadline_seconds` (Number) Deployment progress deadline
- `provider` (String) Traffic managent provider
- `revert_on_deletion` (Boolean) Revert mutated resources to original spec on deletion
- `skip_analysis` (Boolean) Skip analysis and promote canary
- `upstream_ref` (Attributes) Gloo Upstream selector (see [below for nested schema](#nestedatt--spec--upstream_ref))

<a id="nestedatt--spec--analysis"></a>
### Nested Schema for `spec.analysis`

Optional:

- `alerts` (Attributes List) Alert list for this canary analysis (see [below for nested schema](#nestedatt--spec--analysis--alerts))
- `canary_ready_threshold` (Number) Percentage of pods that need to be available to consider canary as ready
- `interval` (String) Schedule interval for this canary
- `iterations` (Number) Number of checks to run for A/B Testing and Blue/Green
- `match` (Attributes List) A/B testing match conditions (see [below for nested schema](#nestedatt--spec--analysis--match))
- `max_weight` (Number) Max traffic weight routed to canary
- `metrics` (Attributes List) Metric check list for this canary (see [below for nested schema](#nestedatt--spec--analysis--metrics))
- `mirror` (Boolean) Mirror traffic to canary
- `mirror_weight` (Number) Weight of traffic to be mirrored
- `primary_ready_threshold` (Number) Percentage of pods that need to be available to consider primary as ready
- `step_weight` (Number) Incremental traffic step weight for the analysis phase
- `step_weight_promotion` (Number) Incremental traffic step weight for the promotion phase
- `step_weights` (List of String) Incremental traffic step weights for the analysis phase
- `threshold` (Number) Max number of failed checks before rollback
- `webhooks` (Attributes List) Webhook list for this canary (see [below for nested schema](#nestedatt--spec--analysis--webhooks))

<a id="nestedatt--spec--analysis--alerts"></a>
### Nested Schema for `spec.analysis.alerts`

Required:

- `name` (String) Name of the this alert
- `provider_ref` (Attributes) Alert provider reference (see [below for nested schema](#nestedatt--spec--analysis--alerts--provider_ref))

Optional:

- `severity` (String) Severity level can be info, warn, error (default info)

<a id="nestedatt--spec--analysis--alerts--provider_ref"></a>
### Nested Schema for `spec.analysis.alerts.severity`

Required:

- `name` (String) Name of the alert provider

Optional:

- `namespace` (String) Namespace of the alert provider



<a id="nestedatt--spec--analysis--match"></a>
### Nested Schema for `spec.analysis.match`

Optional:

- `headers` (Attributes) (see [below for nested schema](#nestedatt--spec--analysis--match--headers))
- `source_labels` (Map of String) Applicable only when the 'mesh' gateway is included in the service.gateways list

<a id="nestedatt--spec--analysis--match--headers"></a>
### Nested Schema for `spec.analysis.match.source_labels`

Optional:

- `exact` (String)
- `prefix` (String)
- `regex` (String) RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax)
- `suffix` (String)



<a id="nestedatt--spec--analysis--metrics"></a>
### Nested Schema for `spec.analysis.metrics`

Required:

- `name` (String) Name of the metric

Optional:

- `interval` (String) Interval of the query
- `query` (String) Prometheus query
- `template_ref` (Attributes) Metric template reference (see [below for nested schema](#nestedatt--spec--analysis--metrics--template_ref))
- `threshold` (Number) Max value accepted for this metric
- `threshold_range` (Attributes) Range accepted for this metric (see [below for nested schema](#nestedatt--spec--analysis--metrics--threshold_range))

<a id="nestedatt--spec--analysis--metrics--template_ref"></a>
### Nested Schema for `spec.analysis.metrics.threshold_range`

Required:

- `name` (String) Name of this metric template

Optional:

- `namespace` (String) Namespace of this metric template


<a id="nestedatt--spec--analysis--metrics--threshold_range"></a>
### Nested Schema for `spec.analysis.metrics.threshold_range`

Optional:

- `max` (Number) Max value accepted for this metric
- `min` (Number) Min value accepted for this metric



<a id="nestedatt--spec--analysis--webhooks"></a>
### Nested Schema for `spec.analysis.webhooks`

Required:

- `name` (String) Name of the webhook
- `url` (String) URL address of this webhook

Optional:

- `metadata` (Map of String) Metadata (key-value pairs) for this webhook
- `mute_alert` (Boolean) Mute all alerts for the webhook
- `timeout` (String) Request timeout for this webhook
- `type` (String) Type of the webhook pre, post or during rollout



<a id="nestedatt--spec--service"></a>
### Nested Schema for `spec.service`

Required:

- `port` (Number) Container port number

Optional:

- `apex` (Attributes) Metadata to add to the apex service (see [below for nested schema](#nestedatt--spec--service--apex))
- `app_protocol` (String) Application protocol of the port
- `backends` (List of String) AppMesh backend array
- `canary` (Attributes) Metadata to add to the canary service (see [below for nested schema](#nestedatt--spec--service--canary))
- `cors_policy` (Attributes) Istio Cross-Origin Resource Sharing policy (CORS) (see [below for nested schema](#nestedatt--spec--service--cors_policy))
- `delegation` (Boolean) enable behaving as a delegate VirtualService
- `gateway_refs` (Attributes List) The list of parent Gateways for a HTTPRoute (see [below for nested schema](#nestedatt--spec--service--gateway_refs))
- `gateways` (List of String) The list of Istio gateway for this virtual service
- `headers` (Attributes) Headers operations (see [below for nested schema](#nestedatt--spec--service--headers))
- `hosts` (List of String) The list of host names for this service
- `match` (Attributes List) URI match conditions (see [below for nested schema](#nestedatt--spec--service--match))
- `mesh_name` (String) AppMesh mesh name
- `name` (String) Kubernetes service name
- `port_discovery` (Boolean) Enable port dicovery
- `port_name` (String) Container port name
- `primary` (Attributes) Metadata to add to the primary service (see [below for nested schema](#nestedatt--spec--service--primary))
- `retries` (Attributes) Retry policy for HTTP requests (see [below for nested schema](#nestedatt--spec--service--retries))
- `rewrite` (Attributes) Rewrite HTTP URIs (see [below for nested schema](#nestedatt--spec--service--rewrite))
- `target_port` (Dynamic) Container target port name
- `timeout` (String) HTTP or gRPC request timeout
- `traffic_policy` (Attributes) Istio traffic policy (see [below for nested schema](#nestedatt--spec--service--traffic_policy))

<a id="nestedatt--spec--service--apex"></a>
### Nested Schema for `spec.service.apex`

Optional:

- `annotations` (Map of String)
- `labels` (Map of String)


<a id="nestedatt--spec--service--canary"></a>
### Nested Schema for `spec.service.canary`

Optional:

- `annotations` (Map of String)
- `labels` (Map of String)


<a id="nestedatt--spec--service--cors_policy"></a>
### Nested Schema for `spec.service.cors_policy`

Optional:

- `allow_credentials` (Boolean)
- `allow_headers` (List of String)
- `allow_methods` (List of String) List of HTTP methods allowed to access the resource
- `allow_origin` (List of String) The list of origins that are allowed to perform CORS requests.
- `allow_origins` (Attributes List) String patterns that match allowed origins (see [below for nested schema](#nestedatt--spec--service--cors_policy--allow_origins))
- `expose_headers` (List of String)
- `max_age` (String)

<a id="nestedatt--spec--service--cors_policy--allow_origins"></a>
### Nested Schema for `spec.service.cors_policy.max_age`

Optional:

- `exact` (String)
- `prefix` (String)
- `regex` (String)



<a id="nestedatt--spec--service--gateway_refs"></a>
### Nested Schema for `spec.service.gateway_refs`

Required:

- `name` (String)

Optional:

- `group` (String)
- `kind` (String)
- `namespace` (String)
- `section_name` (String)


<a id="nestedatt--spec--service--headers"></a>
### Nested Schema for `spec.service.headers`

Optional:

- `request` (Attributes) (see [below for nested schema](#nestedatt--spec--service--headers--request))
- `response` (Attributes) (see [below for nested schema](#nestedatt--spec--service--headers--response))

<a id="nestedatt--spec--service--headers--request"></a>
### Nested Schema for `spec.service.headers.response`

Optional:

- `add` (Map of String)
- `remove` (List of String)
- `set` (Map of String)


<a id="nestedatt--spec--service--headers--response"></a>
### Nested Schema for `spec.service.headers.response`

Optional:

- `add` (Map of String)
- `remove` (List of String)
- `set` (Map of String)



<a id="nestedatt--spec--service--match"></a>
### Nested Schema for `spec.service.match`

Optional:

- `authority` (Attributes) (see [below for nested schema](#nestedatt--spec--service--match--authority))
- `gateways` (List of String) Names of gateways where the rule should be applied.
- `headers` (Attributes) (see [below for nested schema](#nestedatt--spec--service--match--headers))
- `ignore_uri_case` (Boolean) Flag to specify whether the URI matching should be case-insensitive.
- `method` (Attributes) (see [below for nested schema](#nestedatt--spec--service--match--method))
- `name` (String) The name assigned to a match.
- `port` (Number) Specifies the ports on the host that is being addressed.
- `query_params` (Attributes) Query parameters for matching. (see [below for nested schema](#nestedatt--spec--service--match--query_params))
- `scheme` (Attributes) (see [below for nested schema](#nestedatt--spec--service--match--scheme))
- `source_labels` (Map of String)
- `source_namespace` (String) Source namespace constraining the applicability of a rule to workloads in that namespace.
- `uri` (Attributes) (see [below for nested schema](#nestedatt--spec--service--match--uri))
- `without_headers` (Attributes) withoutHeader has the same syntax with the header, but has opposite meaning. (see [below for nested schema](#nestedatt--spec--service--match--without_headers))

<a id="nestedatt--spec--service--match--authority"></a>
### Nested Schema for `spec.service.match.without_headers`

Optional:

- `exact` (String)
- `prefix` (String)
- `regex` (String) RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).


<a id="nestedatt--spec--service--match--headers"></a>
### Nested Schema for `spec.service.match.without_headers`

Optional:

- `exact` (String)
- `prefix` (String)
- `regex` (String) RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).


<a id="nestedatt--spec--service--match--method"></a>
### Nested Schema for `spec.service.match.without_headers`

Optional:

- `exact` (String)
- `prefix` (String)
- `regex` (String) RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).


<a id="nestedatt--spec--service--match--query_params"></a>
### Nested Schema for `spec.service.match.without_headers`

Optional:

- `exact` (String)
- `prefix` (String)
- `regex` (String) RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).


<a id="nestedatt--spec--service--match--scheme"></a>
### Nested Schema for `spec.service.match.without_headers`

Optional:

- `exact` (String)
- `prefix` (String)
- `regex` (String) RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).


<a id="nestedatt--spec--service--match--uri"></a>
### Nested Schema for `spec.service.match.without_headers`

Optional:

- `exact` (String)
- `prefix` (String)
- `regex` (String) RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).


<a id="nestedatt--spec--service--match--without_headers"></a>
### Nested Schema for `spec.service.match.without_headers`

Optional:

- `exact` (String)
- `prefix` (String)
- `regex` (String) RE2 style regex-based match (https://github.com/google/re2/wiki/Syntax).



<a id="nestedatt--spec--service--primary"></a>
### Nested Schema for `spec.service.primary`

Optional:

- `annotations` (Map of String)
- `labels` (Map of String)


<a id="nestedatt--spec--service--retries"></a>
### Nested Schema for `spec.service.retries`

Optional:

- `attempts` (Number) Number of retries for a given request
- `per_try_timeout` (String) Timeout per retry attempt for a given request
- `retry_on` (String) Specifies the conditions under which retry takes place


<a id="nestedatt--spec--service--rewrite"></a>
### Nested Schema for `spec.service.rewrite`

Optional:

- `uri` (String)


<a id="nestedatt--spec--service--traffic_policy"></a>
### Nested Schema for `spec.service.traffic_policy`

Optional:

- `connection_pool` (Attributes) (see [below for nested schema](#nestedatt--spec--service--traffic_policy--connection_pool))
- `load_balancer` (Attributes) Settings controlling the load balancer algorithms. (see [below for nested schema](#nestedatt--spec--service--traffic_policy--load_balancer))
- `outlier_detection` (Attributes) Settings controlling eviction of unhealthy hosts from the load balancing pool. (see [below for nested schema](#nestedatt--spec--service--traffic_policy--outlier_detection))
- `tls` (Attributes) Istio TLS related settings for connections to the upstream service (see [below for nested schema](#nestedatt--spec--service--traffic_policy--tls))

<a id="nestedatt--spec--service--traffic_policy--connection_pool"></a>
### Nested Schema for `spec.service.traffic_policy.tls`

Optional:

- `http` (Attributes) HTTP connection pool settings. (see [below for nested schema](#nestedatt--spec--service--traffic_policy--tls--http))

<a id="nestedatt--spec--service--traffic_policy--tls--http"></a>
### Nested Schema for `spec.service.traffic_policy.tls.http`

Optional:

- `h2_upgrade_policy` (String) Specify if http1.1 connection should be upgraded to http2 for the associated destination.
- `http1_max_pending_requests` (Number) Maximum number of pending HTTP requests to a destination.
- `http2_max_requests` (Number) Maximum number of requests to a backend.
- `idle_timeout` (String) The idle timeout for upstream connection pool connections.
- `max_requests_per_connection` (Number) Maximum number of requests per connection to a backend.
- `max_retries` (Number)



<a id="nestedatt--spec--service--traffic_policy--load_balancer"></a>
### Nested Schema for `spec.service.traffic_policy.tls`

Optional:

- `consistent_hash` (Attributes) (see [below for nested schema](#nestedatt--spec--service--traffic_policy--tls--consistent_hash))
- `locality_lb_setting` (Attributes) (see [below for nested schema](#nestedatt--spec--service--traffic_policy--tls--locality_lb_setting))
- `simple` (String)

<a id="nestedatt--spec--service--traffic_policy--tls--consistent_hash"></a>
### Nested Schema for `spec.service.traffic_policy.tls.consistent_hash`

Optional:

- `http_cookie` (Attributes) Hash based on HTTP cookie. (see [below for nested schema](#nestedatt--spec--service--traffic_policy--tls--consistent_hash--http_cookie))
- `http_header_name` (String) Hash based on a specific HTTP header.
- `http_query_parameter_name` (String) Hash based on a specific HTTP query parameter.
- `minimum_ring_size` (Number)
- `use_source_ip` (Boolean) Hash based on the source IP address.

<a id="nestedatt--spec--service--traffic_policy--tls--consistent_hash--http_cookie"></a>
### Nested Schema for `spec.service.traffic_policy.tls.consistent_hash.use_source_ip`

Optional:

- `name` (String) Name of the cookie.
- `path` (String) Path to set for the cookie.
- `ttl` (String) Lifetime of the cookie.



<a id="nestedatt--spec--service--traffic_policy--tls--locality_lb_setting"></a>
### Nested Schema for `spec.service.traffic_policy.tls.locality_lb_setting`

Optional:

- `distribute` (Attributes List) Optional: only one of distribute or failover can be set. (see [below for nested schema](#nestedatt--spec--service--traffic_policy--tls--locality_lb_setting--distribute))
- `enabled` (Boolean) enable locality load balancing, this is DestinationRule-level and will override mesh wide settings in entirety.
- `failover` (Attributes List) Optional: only failover or distribute can be set. (see [below for nested schema](#nestedatt--spec--service--traffic_policy--tls--locality_lb_setting--failover))

<a id="nestedatt--spec--service--traffic_policy--tls--locality_lb_setting--distribute"></a>
### Nested Schema for `spec.service.traffic_policy.tls.locality_lb_setting.failover`

Optional:

- `from` (String) Originating locality, '/' separated, e.g.
- `to` (Map of String) Map of upstream localities to traffic distribution weights.


<a id="nestedatt--spec--service--traffic_policy--tls--locality_lb_setting--failover"></a>
### Nested Schema for `spec.service.traffic_policy.tls.locality_lb_setting.failover`

Optional:

- `from` (String) Originating region.
- `to` (String)




<a id="nestedatt--spec--service--traffic_policy--outlier_detection"></a>
### Nested Schema for `spec.service.traffic_policy.tls`

Optional:

- `base_ejection_time` (String) Minimum ejection duration.
- `consecutive5xx_errors` (Number) Number of 5xx errors before a host is ejected from the connection pool.
- `consecutive_errors` (Number)
- `consecutive_gateway_errors` (Number) Number of gateway errors before a host is ejected from the connection pool.
- `interval` (String) Time interval between ejection sweep analysis.
- `max_ejection_percent` (Number)
- `min_health_percent` (Number)


<a id="nestedatt--spec--service--traffic_policy--tls"></a>
### Nested Schema for `spec.service.traffic_policy.tls`

Optional:

- `ca_certificates` (String)
- `client_certificate` (String) REQUIRED if mode is 'MUTUAL'.
- `mode` (String)
- `private_key` (String) REQUIRED if mode is 'MUTUAL'.
- `sni` (String) SNI string to present to the server during TLS handshake.
- `subject_alt_names` (List of String)




<a id="nestedatt--spec--target_ref"></a>
### Nested Schema for `spec.target_ref`

Required:

- `api_version` (String)
- `kind` (String)
- `name` (String)


<a id="nestedatt--spec--autoscaler_ref"></a>
### Nested Schema for `spec.autoscaler_ref`

Required:

- `api_version` (String)
- `kind` (String)
- `name` (String)

Optional:

- `primary_scaler_queries` (Map of String)


<a id="nestedatt--spec--ingress_ref"></a>
### Nested Schema for `spec.ingress_ref`

Required:

- `api_version` (String)
- `kind` (String)
- `name` (String)


<a id="nestedatt--spec--upstream_ref"></a>
### Nested Schema for `spec.upstream_ref`

Required:

- `api_version` (String)
- `kind` (String)
- `name` (String)

Optional:

- `namespace` (String)


